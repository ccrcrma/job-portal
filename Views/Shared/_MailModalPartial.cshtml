@model JobLinkViewModel
<div class="modal fade" id="email-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Send job to your friend</h5>
                <button type="button" class="close" data-dismiss="modal" id="close-button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="job-invite-form-container">
                <form asp-action="MailLinkToFriend" asp-controller="Mail" id="job-link-form">
                    <div class="text-danger" asp-validation-summary="ModelOnly"></div>
                    <div class="modal-body">
                        <partial name="_InvitationFormData"></partial>
                    </div>
                    <div class="modal-footer d-flex justify-content-end">
                        <button class="btn btn-sm bg-success" id="submit-btn">Send</button>
                        <button data-dismiss="modal" class="btn btn-sm bg-danger">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>




@using (Html.BeginScripts())
{
    <partial name="_ValidationScriptsPartial"></partial>
    <script>
    var submitButton = document.getElementById("submit-btn");
    var form = document.querySelector("form");
    submitButton.onclick = function (event) {
        event.preventDefault();
        form.dispatchEvent(new Event("submit"));
    }

    form.onsubmit = async function (event) {
        event.preventDefault();
        var formData = new FormData(form);
        $("#job-link-form").validate();
        if($("#job-link-form").valid())
        {
            var res = await fetch(form.action, {
            method: "POST",
            body: formData
        });
            if (res.status === 400) {
                var text = await res.text();
                document.querySelector(".modal-body").innerHTML = text;
            } else if (res.status === 200) {
                console.log("form submitted successfully");
                document.getElementById("close-button").click();
                window.location= window.location.href;
            }
        }
    }
</script>
}
